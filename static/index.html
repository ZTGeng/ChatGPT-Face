<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open AI Chatting</title>
    <meta name="author" content="Geng">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app" class="container" style="height: 100vh">
        <nav class="navbar fixed-top navbar-light bg-light">
            <div class="container-fluid">
                <h1 class="navbar-brand">{{ page_title }}</h1>
                
                <form class="">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" v-model="api_key_choice"name="apiKeyChoice" value="default" id="apiKeyChoiceDefault" checked>
                        <label class="form-check-label" for="apiKeyChoiceDefault">
                            {{ api_key_choice_default }}
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" v-model="api_key_choice" name="apiKeyChoice" value="custom" id="apiKeyChoiceCustom">
                        <label class="form-check-label me-2" for="apiKeyChoiceCustom">
                            {{ api_key_choice_custom }}
                        </label>
                        <input class="me-2" type="text" placeholder="API-KEY" aria-label="API-KEY">
                        <a class="form-check-label fw-bold me-2 alert-link" href="https://openai.com/pricing" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom" :title="api_key_explanation">&#9432;</a>
                    </div>
                </form>
            </div>
        </nav>
        
        <div class="row" style="min-height: 100%">
            <div class="col col-4"></div>
            <div class="col" style="min-height: 100%">
                <div class="d-inline-flex flex-column justify-content-end" style="width: 100%; min-height: 100%;">
                    <div v-for="message in messages" class="mb-3" :class="message.from === 'bot' ? 'me-auto' : 'ms-auto'">
                        <div class="card" :class="message.from === 'bot' ? 'bg-light text-dark me-3' : 'bg-primary text-white ms-3'">
                            <div class="card-body">
                                {{ message.text }}
                            </div>
                        </div>
                    </div>
                    <div style="height: 200px"></div>
                </div>
            </div>
        </div>
        
        <nav class="navbar fixed-bottom navbar-light bg-light">
            <div class="container-fluid">
                <div class="input-group mb-3 px-3">
                    <textarea type="text" class="form-control me-2" aria-label="Message" aria-describedby="send-button" style="max-height: 150px;"
                        :placeholder="message_input_placeholder" 
                        v-model="message"
                        @keyup.enter.shift="getResponse"></textarea>
                    <button class="btn btn-outline-secondary" type="button" id="send-button" @click="getResponse">{{ message_button_send }}</button>
                </div>
            </div>
        </nav>


    </div>

    <script>

        const { createApp } = Vue
        const app = createApp({
            data() {
                const resources = navigator.language.slice(0, 2) === "zh" ?
                {
                    page_title: 'Open AI 聊天',
                    api_key_choice_default: '使用本站 OPENAI API-KEY（有流量限制）',
                    api_key_choice_custom: '使用我的 OPENAI API-KEY：',
                    api_key_explanation: `关于 OPENAI API-KEY：
目前注册 openai.com 开发者用户时，会获得 5 美元的免费额度。
开发者用户可以免费创建 API-KEY，但是使用 API-KEY 时会消耗额度。
在免费额度用完后，需要提供有效付款方式继续使用API-KEY。
并不推荐在不受信任的站点使用自己的 API-KEY。
了解详细信息请点击。`,
                    message_input_placeholder: 'Shift + Enter 发送',
                    message_button_send: '发送',
                } :
                {
                    page_title: 'Open AI Chatting',
                    api_key_choice_default: 'Use OPENAI API-KEY On This Site (Limited Traffic)',
                    api_key_choice_custom: 'Use My OPENAI API-KEY:',
                    api_key_explanation: `About OPENAI API-KEY:
Currently, when registering as a developer user on openai.com, you will receive $5 in free credits.
Developer users can create API-KEYs for free, but using API-KEYs will consume credits.
After the free credits are used up, you need to provide a valid payment method to continue using API-KEYs.
It is not recommended to use your own API-KEY on untrusted sites.
Click for more information.`,
                    message_input_placeholder: 'Shift + Enter to send',
                    message_button_send: 'Send',
                }
                const props = {
                    api_key_choice: 'default',
                    message: '',
                    messages: [
                        {
                            text: 'Hello, I am a bot.',
                            from: 'bot'
                        },
                        {
                            text: 'How are you?',
                            from: 'human'
                        },
                        {
                            text: 'I am fine, thank you.',
                            from: 'bot'
                        },
                        {
                            text: 'What is your name?',
                            from: 'human'
                        },
                        {
                            text: 'My name is Open AI.',
                            from: 'bot'
                        },
                        {
                            text: 'Hello, I am a bot.',
                            from: 'bot'
                        },
                        {
                            text: 'How are you?',
                            from: 'human'
                        },
                        {
                            text: 'I am fine, thank you.',
                            from: 'bot'
                        },
                        {
                            text: 'What is your name?',
                            from: 'human'
                        },
                        {
                            text: 'My name is Open AI.',
                            from: 'bot'
                        },
                        {
                            text: 'Hello, I am a bot.',
                            from: 'bot'
                        },
                        {
                            text: 'How are you?',
                            from: 'human'
                        },
                        {
                            text: 'I am fine, thank you.',
                            from: 'bot'
                        },
                        {
                            text: 'What is your name?',
                            from: 'human'
                        },
                        // {
                    ],
                }
                return { ...resources, ...props}
            },
            methods: {
                async getResponse() {
                    const response = await fetch('/api/chatting', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: this.message
                        })
                    })
                    const data = await response.json()
                    this.message = ''
                    this.messages.push({
                        text: data.message,
                        from: 'bot'
                    })
                }
            }
        })
        app.mount('#app')
    </script>
</body>
</html>